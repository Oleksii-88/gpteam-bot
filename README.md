# GPTeam Telegram Bot

Умный Telegram бот с системой регистрации, ролевым доступом и анализом изображений с помощью OpenAI Vision API.

## Возможности

### Основные функции
- Анализ изображений с помощью OpenAI Vision API
- Возможность задавать вопросы об изображениях
- Детальное описание содержимого фотографий

### Система безопасности
- Регистрация пользователей с одобрением администратором
- Ролевая модель доступа (USER и ADMIN роли)
- Обработка сообщений только от зарегистрированных пользователей

### Административные команды
- `/make_admin <user_id>` - назначить пользователя администратором
- `/revoke_admin <user_id>` - отозвать права администратора
- `/my_roles` - просмотр своих ролей

### Техническая реализация
- Асинхронная архитектура с использованием python-telegram-bot
- Интеграция с OpenAI Vision API
- Полное покрытие тестами

## Требования

- Python 3.11+
- Telegram Bot Token (от @BotFather)
- OpenAI API Key

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/Oleksii-88/gpteam-bot.git
   cd gpteam-bot
   ```

2. Создайте виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # На Windows: venv\Scripts\activate
   ```

3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

## Настройка

1. Создайте файл `.env` в корневой директории на основе `.env.example`:
   ```env
   # Настройки Telegram
   TELEGRAM_BOT_TOKEN=your_telegram_bot_token  # Получите у @BotFather

   # Настройки OpenAI
   OPENAI_API_KEY=your_openai_api_key  # Получите на platform.openai.com
   ```

2. Замените значения на ваши токены:
   - `your_telegram_bot_token` - токен от [@BotFather](https://t.me/BotFather)
   - `your_openai_api_key` - ключ с [OpenAI Platform](https://platform.openai.com/api-keys)

## Запуск

### Локально

```bash
python -m app.main
```

### Запуск тестов

```bash
python -m pytest tests/
```

## Структура проекта

```
.
├── app/
│   ├── __init__.py
│   ├── main.py          # Основной файл бота
│   ├── roles.py         # Управление ролями пользователей
│   ├── decorators.py    # Декораторы для проверки прав
│   ├── registration.py  # Система регистрации
│   ├── vision_helper.py # Работа с OpenAI Vision API
│   └── openai_helper.py # Общие функции для работы с OpenAI
├── tests/
│   ├── test_vision_helper.py  # Тесты анализа изображений
│   └── ...             # Другие тесты
├── .env                # Файл с переменными окружения
├── .env.example        # Пример конфигурации
├── setup.py           # Настройки пакета
└── requirements.txt    # Зависимости Python
```

## Использование

1. Начните чат с ботом, отправив команду `/start`
2. Подайте заявку на регистрацию
3. Дождитесь одобрения заявки администратором
4. После одобрения вы получите роль USER и сможете:
   - Отправлять изображения для анализа
   - Добавлять подписи к изображениям с вопросами
   - Получать детальные описания содержимого фотографий

## Разработка

Проект имеет модульную структуру и легко расширяем:
- Добавляйте новые роли в `roles.py`
- Создавайте новые декораторы в `decorators.py`
- Расширяйте функционал регистрации в `registration.py`
- Улучшайте анализ изображений в `vision_helper.py`

Весь код покрыт тестами, которые служат также примерами использования.

## Тестирование

Проект содержит полный набор тестов для всех компонентов:
- Тесты анализа изображений с моками OpenAI API
- Тесты системы регистрации
- Тесты управления ролями
- Тесты обработчиков команд

Запуск тестов с отчетом о покрытии:
```bash
pytest -v --cov=app --cov-report=term-missing
```
- Тесты декораторов

Запуск тестов с отчетом о покрытии:
```bash
python -m pytest tests/ --cov=app
```
